<!DOCTYPE html>
<html>
<head>
  <title>Feed</title>
  <style>
    body {
      margin: 0;
      background: #fafafa;
      font-family: Arial, Helvetica, sans-serif;
      display: flex;
      justify-content: center;
    }

    .wrapper {
      width: 500px;
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
    }

    .navbar h3 {
      margin: 0;
      font-size: 16px;
    }

    .logout-btn {
      background: #ff4d4d;
      border: none;
      padding: 6px 12px;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }

    .logout-btn:hover {
      background: #cc0000;
    }

    .container {
      width: 100%;
    }

    .post {
      background: white;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    img {
      width: 100%;
      border-radius: 8px;
      margin: 10px 0;
    }

    input[type="file"],
    input[type="text"] {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: #0095f6;
      color: white;
      cursor: pointer;
      font-size: 13px;
      margin-right: 5px;
    }

    button:hover {
      background: #0077cc;
    }

    .delete-btn {
      background: #ff4d4d;
    }

    .delete-btn:hover {
      background: #cc0000;
    }

    .pagination {
      text-align: center;
      margin-top: 20px;
      padding-bottom: 30px;
    }

    .pagination a {
      margin: 0 8px;
      text-decoration: none;
      color: #0095f6;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="wrapper">

  <div class="navbar">
    <h3>Hi, <%= username %> üëã</h3>

    <form action="/logout" method="POST">
      <button class="logout-btn">Logout</button>
    </form>
  </div>

  <div class="container">

    <h2>Create Post</h2>
    <form action="/create" method="POST" enctype="multipart/form-data">
      <input type="file" name="image" required>
      <input type="text" name="caption" placeholder="Caption">
      <button type="submit">Upload</button>
    </form>

    <hr>

    <% posts.forEach(post => { %>
      <div class="post">

        <h4><%= post.user.username %></h4>

        <img src="<%= post.imageUrl %>">

        <p><%= post.caption %></p>

        <!-- ‚ù§Ô∏è LIKE SECTION -->
        <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">

          <form action="/like/<%= post._id %>" method="POST" style="display:inline;">
            <button style="background:none;border:none;font-size:20px;cursor:pointer;">

              <% 
                const liked = post.likes.some(
                  id => id.toString() === currentUser.toString()
                );
              %>

              <% if (liked) { %>
                ‚ù§Ô∏è
              <% } else { %>
                ü§ç
              <% } %>

            </button>
          </form>

          <span style="font-size:14px; color:#555;">
            <%= post.likes.length %> likes
          </span>

        </div>

        <!-- ‚úè EDIT & üóë DELETE -->
        <% if (post.user._id.toString() === currentUser.toString()) { %>
          <div style="margin-top:10px;">
            <form action="/edit/<%= post._id %>" method="GET" style="display:inline;">
              <button>Edit</button>
            </form>

            <form action="/delete/<%= post._id %>" method="POST" style="display:inline;">
              <button class="delete-btn">Delete</button>
            </form>
          </div>
        <% } %>

      </div>
    <% }) %>

    <div class="pagination">
      <% if (currentPage > 1) { %>
        <a href="/feed?page=<%= currentPage - 1 %>">Previous</a>
      <% } %>

      Page <%= currentPage %> of <%= totalPages %>

      <% if (currentPage < totalPages) { %>
        <a href="/feed?page=<%= currentPage + 1 %>">Next</a>
      <% } %>
    </div>

  </div>
</div>

</body>
</html>